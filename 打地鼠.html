<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>cut the rope</title>

  <style>
    * {
      margin: auto;
      box-sizing: border-box;
      color: white;
    }

    body {
      background: url(./resource/body.jpg);
    }

    hr {
      margin: auto;
      margin-bottom: 10px;
      width: 50%;
      height: 2px;
      border: 0;
      background-image: linear-gradient(to right, rgba(124, 124, 124, 0), rgba(235, 213, 179, 0.75), rgba(124, 124, 124, 0));
    }

    .hole {
      width: 75px;
      height: 160px;
    }

    .hole1 {
      width: 75px;
      height: 75px;
    }

    .hole2 {
      width: 75px;
      height: 160px;
    }

    .dott {
      width: 75px;
      height: 75px;
      background: url(./resource/dot.png)no-repeat center/cover;
    }

    .rc {
      background: url(./resource/rcandy.png)no-repeat center/cover;
    }

    .rp {
      background: url(./resource/rpoison.png)no-repeat center/cover;
    }

    .candy {
      background: url(./resource/rrope.png)no-repeat center/cover;
    }

    .cutu {
      background: url(./resource/cutrope.png)no-repeat center/cover;
    }

    .cutdc {
      background: url(./resource/cutcandy.png)no-repeat center/cover;
    }

    .cutdp {
      background: url(./resource/cutpoison.png)no-repeat center/cover;
    }

    .poison {
      background: url(./resource/rrope.png)no-repeat center/cover;
    }

    #dot {
      padding-top: 50px;
      margin-bottom: -32px;
    }

    /* #rope {
      margin-top: -5px;
    } */

    .bottom {
      position: absolute;
      left: 52px;
      bottom: 0px;
    }

    #box {
      position: relative;
      cursor: url(./resource/knife.png) 10 10, auto;
      width: 800px;
      height: 800px;
      background: url(./resource/bg.png);
      text-align: center;
      top: 10px;
    }

    input {
      cursor: url(./resource/knife.png) 10 10, auto;
    }

    .gua {
      background: url(./resource/om.png);
    }

    .frog {
      background: url(./resource/frog.png);
      transition-delay: .2s;
    }

    @keyframes animation {
      from {
        margin-top: 0;
      }

      to {
        margin-top: 242px;
        visibility: hidden;
      }
    }

    .animation {
      animation-name: animation;
      animation-duration: .3s;
      animation-timing-function: ease;
      animation-fill-mode: forwards;
    }

    #sgame {
      position: absolute;
      width: 800px;
      height: 800px;
      cursor: url(./resource/knife.png) 10 10, auto;
      background-color: rgba(0, 0, 0, 0.8);
      top: 0px;
    }

    .hide {
      display: none;
    }

    #start {
      width: 200px;
      height: 65px;
      color: rgb(0, 0, 0);
      font-size: 30px;
      border-radius: 15px;
      border: 0;
      box-shadow: rgba(0, 0, 0, 0.35) 0px 10px 15px;
    }

    .rule {
      margin-top: 160px;
      margin-bottom: 20px;
      font-size: 30px;
      color: rgb(185, 185, 185);
    }

    #start:hover {
      background-color: rgb(206, 206, 206);
    }

    .rule1 {
      margin-bottom: 20px;
      display: flex;
      width: 140px;
      flex-wrap: wrap;
    }

    .rule2 {
      font-size: 30px;
    }


    #hole21 {
      position: relative;
      padding: 0;
      left: 54px;
      top: 258px;
    }

    #hole22 {
      position: relative;
      padding: 0;
      left: 131px;
      top: 258px;
    }

    #hole23 {
      position: relative;
      padding: 0;
      left: 208px;
      top: 258px;
    }

    #hole24 {
      position: relative;
      padding: 0;
      left: 285px;
      top: 258px;
    }

    #hole25 {
      position: relative;
      padding: 0;
      left: 362px;
      top: 258px;
    }

    #hole26 {
      position: relative;
      padding: 0;
      left: 439px;
      top: 258px;
    }

    #hole27 {
      position: relative;
      padding: 0;
      left: 516px;
      top: 258px;
    }

    #hole28 {
      position: relative;
      padding: 0;
      left: 593px;
      top: 258px;
    }

    #hole29 {
      position: relative;
      padding: 0;
      left: 670px;
      top: 258px;
    }

    #rope div {
      position: absolute;
    }

    .home {
      width: 419px;
      height: 120px;
      background: url(./resource/home.jpg);
    }
  </style>
</head>

<body>
  <div class="home"></div>
  <div id="box">
    <table id="dot">
      <tr>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
        <td class="dott"></td>
      </tr>
    </table>
    <table>
      <tr>
        <td class="hole" id="hole1"></td>
        <td class="hole" id="hole2"></td>
        <td class="hole" id="hole3"></td>
        <td class="hole" id="hole4"></td>
        <td class="hole" id="hole5"></td>
        <td class="hole" id="hole6"></td>
        <td class="hole" id="hole7"></td>
        <td class="hole" id="hole8"></td>
        <td class="hole" id="hole9"></td>
      </tr>
    </table>

    <table id="rope">
      <tr>
        <td>
          <div class="hole2" id="hole21"></div>
        </td>
        <td>
          <div class="hole2" id="hole22"></div>
        </td>
        <td>
          <div class="hole2" id="hole23"></div>
        </td>
        <td>
          <div class="hole2" id="hole24"></div>
        </td>
        <td>
          <div class="hole2" id="hole25"></div>
        </td>
        <td>
          <div class="hole2" id="hole26"></div>
        </td>
        <td>
          <div class="hole2" id="hole27"></div>
        </td>
        <td>
          <div class="hole2" id="hole28"></div>
        </td>
        <td>
          <div class="hole2" id="hole29"></div>
        </td>
      </tr>
    </table>
    <div class="bottom">
      <table id="frog">
        <tr>
          <td class="hole1" id="hole11"></td>
          <td class="hole1" id="hole12"></td>
          <td class="hole1" id="hole13"></td>
          <td class="hole1" id="hole14"></td>
          <td class="hole1" id="hole15"></td>
          <td class="hole1" id="hole16"></td>
          <td class="hole1" id="hole17"></td>
          <td class="hole1" id="hole18"></td>
          <td class="hole1" id="hole19"></td>
        </tr>
      </table>
      <hr style="margin-top: 20px;">

      <p style="margin-bottom: 10px;">目前分數: <span id="score">0</span>
      <p style="margin-bottom: 10px;"><span>最高分玩家:<span id="highname" style="margin-right:10px;">暫無最高分</span></span>
        <span>分數: <span id="highscore">0</span></span>
      </p>
      </p>
      <hr>
    </div>
    <div id="sgame">
      <div class="rule">使用滑鼠或鍵盤對應數字鍵...</div>
      <div class="rule" style="margin-top: 0px;">遊戲時間: 15 s</div>
      <div class="rule1">
        <div class="rule2"><img src="./resource/candy.png" alt=""></div>
        <div class="rule2">+1分</div>
        <div class="rule2"><img src="./resource/poison.png" alt=""></div>
        <div class="rule2">-1分</div>
      </div>
      <input type="button" value="開始遊戲" id="start">
    </div>

  </div>

  <script>
    const holes = document.getElementsByClassName('hole')
    const hole1s = document.getElementsByClassName('hole1')
    const hole2s = document.getElementsByClassName('hole2')
    const start = document.getElementById('start')
    const scoreText = document.getElementById('score')
    const highnameText = document.getElementById('highname')
    const highscoreText = document.getElementById('highscore')

    const high = { score: 0, name: '匿名' }

    let score = 0
    let timer = 0

    const audio = new Audio()
    audio.src = './resource/eat.mp3'
    audio.preload = 'auto'

    const audio2 = new Audio()
    audio2.src = './resource/cut.mp3'
    audio2.preload = 'auto'

    // 讀取資料
    const storage = JSON.parse(localStorage.getItem('dadishu'))

    if (storage) {
      high.name = storage.name
      high.score = storage.score
      // 修改最高分顯示文字
      highnameText.innerText = high.name
      highscoreText.innerText = high.score
    }

    start.onclick = () => {
      start.disabled = true
      sgame.classList.add('hide')
      score = 0
      scoreText.innerText = score
      // 每一輪
      timer = setInterval(game, 1500)
      game()
      // 遊戲結束
      setTimeout(end, 15 * 1000)
    }
    // 遊戲開始
    const game = () => {
      // 先清
      for (let i = 0; i < 9; i++) {
        hole1s[i].classList.remove('gua')
        hole1s[i].classList.remove('frog')

        hole2s[i].classList.remove('rc')
        hole2s[i].classList.remove('rp')
        hole2s[i].classList.remove('cutdc')
        hole2s[i].classList.remove('cutdp')
        hole2s[i].classList.remove('animation')

        holes[i].classList.remove('candy')
        holes[i].classList.remove('cutu')
        holes[i].classList.remove('poison')
      }
      // 隨機變色
      for (let i = 0; i < 4; i++) {
        ran = Math.round(Math.random() * (holes.length - 1))
        holes[ran].classList.add('candy')
        hole1s[ran].classList.add('gua')
        hole2s[ran].classList.add('rc')
      }
      for (let j = 0; j < 1; j++) {
        ran2 = Math.round(Math.random() * (holes.length - 1))
        holes[ran2].classList.add('poison')
        hole1s[ran2].classList.add('gua')
        hole2s[ran2].classList.add('rp')
        hole2s[ran2].classList.remove('rc')
        holes[ran2].classList.remove('candy')
      }
    }
    // 遊戲結束
    const end = () => {
      clearInterval(timer)
      // 把顏色清掉
      for (let i = 0; i < 9; i++) {
        holes[i].classList.remove('candy')
        holes[i].classList.remove('cutu')
        holes[i].classList.remove('poison')

        hole1s[i].classList.remove('gua')
        hole1s[i].classList.remove('frog')

        hole2s[i].classList.remove('rc')
        hole2s[i].classList.remove('rp')
        hole2s[i].classList.remove('cutdc')
        hole2s[i].classList.remove('cutdp')
      }
      start.disabled = false
      sgame.classList.remove('hide')
      alert(`遊戲結束，你得了${score}分`)
      // 記錄最高分
      if (score > high.score) {

        const input = prompt('新紀錄!，請輸入您的名字')
        high.score = score
        high.name = input || '匿名'

        highnameText.innerText = high.name
        highscoreText.innerText = high.score

        // localStorage.setItem(資料名,文字)
        // 變數轉文字JSON.stringify
        localStorage.setItem('dadishu', JSON.stringify(high))
      }
    }
    for (let i = 0; i < 9; i++) {
      // 點擊變色
      holes[i].onclick = () => {
        if (holes[i].classList.contains('candy')) {
          holes[i].classList.replace('candy', 'cutu')
          hole2s[i].classList.replace('rc', 'cutdc')
          hole1s[i].classList.replace('gua', 'frog')
          hole2s[i].classList.add('animation')
          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score++
          scoreText.innerText = score
        }
        if (holes[i].classList.contains('poison')) {
          holes[i].classList.replace('poison', 'cutu')
          hole2s[i].classList.replace('rp', 'cutdp')
          hole1s[i].classList.replace('gua', 'frog')
          hole2s[i].classList.add('animation')
          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score--
          scoreText.innerText = score
        }
      }
      hole2s[i].onclick = () => {
        if (hole2s[i].classList.contains('rc')) {
          holes[i].classList.replace('candy', 'cutu')
          hole2s[i].classList.replace('rc', 'cutdc')
          hole1s[i].classList.replace('gua', 'frog')
          hole2s[i].classList.add('animation')
          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score++
          scoreText.innerText = score
        }
        if (hole2s[i].classList.contains('rp')) {
          holes[i].classList.replace('poison', 'cutu')
          hole2s[i].classList.replace('rp', 'cutdp')
          hole1s[i].classList.replace('gua', 'frog')
          hole2s[i].classList.add('animation')
          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score--
          scoreText.innerText = score
        }
      }
    }

    document.onkeydown = (event) => {
      // 按了什麼鍵
      const key = event.key
      // 如果是數字鍵
      if (!isNaN(key)) {
        // 找到對應的格子
        const target = document.getElementById(`hole${key}`)
        const target1 = document.getElementById(`hole1${key}`)
        const target2 = document.getElementById(`hole2${key}`)
        // 如果有找到
        if (target && target.classList.contains('candy')) {
          target.classList.replace('candy', 'cutu')
          target1.classList.replace('gua', 'frog')
          target2.classList.replace('rc', 'cutdc')
          target2.classList.add('animation')

          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score++
          scoreText.innerText = score
        }
        if (target && target.classList.contains('poison')) {
          target.classList.replace('poison', 'cutu')
          target1.classList.replace('gua', 'frog')
          target2.classList.replace('rp', 'cutdp')
          target2.classList.add('animation')

          audio.pause();
          audio.currentTime = 0;
          setTimeout(function () {
            audio.play();
          }, 300);
          audio2.pause();
          audio2.currentTime = 0;
          audio2.play();

          score--
          scoreText.innerText = score
        }
      }
    }
  </script>
</body>

</html>